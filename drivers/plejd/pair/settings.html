<script type="text/javascript">
    Homey.setTitle(__('pair.title.device'));

    let cryptokey = document.getElementById('cryptokey');
    let name = document.getElementById('name');
    let id = document.getElementById('plejdId');

    let debounceSave = debounce(save, 500);

    cryptokey.addEventListener("keypress", debounceSave);
    name.addEventListener("keypress", debounceSave);
    id.addEventListener("keypress", debounceSave);

    Homey.emit('getSettings', {}, (err,result) => {
        if (err) {
            Homey.alert(err);
        } else {
            console.log('Retrieved settings from backend');
            console.log(result);
            if (result) {
                document.getElementById("cryptokey").value = result.cryptokey;
            }
        }
    });


    function save() {
      Homey.emit('save', {
          id: document.getElementById('plejdId').value,
          name: name.value,
          cryptokey: cryptokey.value
      }, (err, result) => {
          debugger;
          console.log("No error returned from backend");
          if (err) {
            Homey.alert(err);
          }
      });
    }

    function debounce(func, wait, immediate) {
      var timeout;
      return function() {
        var context = this, args = arguments;
        var later = function() {
          timeout = null;
          if (!immediate) func.apply(context, args);
        };
        var callNow = immediate && !timeout;
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
        if (callNow) func.apply(context, args);
      };
    };

</script>

<form>
    <label for="name">Name</label>
    <input type="text" id="name" name="name" placeholder=""/><br/>
    <label for="plejdId">ID</label>
    <input type="text" id="plejdId" name="plejdId" placeholder="11"/><br/>
    <label for="cryptokey">Crypto key</label>
    <input type="text" id="cryptokey" name="cryptokey" placeholder="22-60-38-37-B0..."/><br/>
</form>
